---
title: "New Mexico Data Comparison"
author: "Joe Champion, Thea Sukianto"
date: "February 23, 2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r results='hide'}
library(dplyr)
library(ggplot2)
library(tidyr)
```
## Prepare Data

We append flags to the `candidate` data with the `clean_location_data` function from the `animaltracker` package.

If the `Rate` is greater than 84, we append a `RateFlag`.

If the `Course` is greater than or equal to 100, we append a `CourseFlag`.

If the `Distance` is greater than or equal to 840, we append a `DistanceFlag`.

In the cleaning process, observations with a `DistanceFlag`, or 2+ flags are removed.

However, the data is left unchanged in this case for comparison purposes.
```{r}
candidate <- read.csv("df_candidate.csv", stringsAsFactors = FALSE)
correct <- read.csv("df_correct.csv", stringsAsFactors = FALSE)
print(nrow(candidate))
print(nrow(correct))
```
We use the `dplyr` package to join the `candidate` and `correct` data on `Cow` and `Index`.
```{r}
join <- dplyr::full_join(candidate, correct, by=c("Cow", "Index"))
print(nrow(join))
```
There are approximately 500 more observations in the joined data than there are in each individual dataset.

## Analysis

First, we determine which observations in `candidate` are to be kept according to the `clean_location_data` function.
```{r}
join <- join %>% 
  dplyr::rename(Keep.y = Keep,
                DistFlag.x = DistanceFlag,
                DistFlag.y = DistFlag) %>% 
  dplyr::mutate(Keep.x = 1*(TotalFlags.x < 2 & !DistFlag.x)) 
```
There are 165039 observations that both `correct` and `candidate` keep and 2935 that both discard. 

However, `correct` discards 337 that `candidate` would not and `candidate` discards 101 that `correct` would not.
```{r}
join %>% dplyr::group_by(Keep.x, Keep.y) %>%  summarise(n = n())
```
```{r}
join %>% 
  dplyr::filter(Keep.x < Keep.y) %>% 
  dplyr::select(RateFlag.x, CourseFlag.x, DistFlag.x, RateFlag.y, CourseFlag.y, DistFlag.y) %>% 
  dplyr::summarise(RateFlag.x = sum(RateFlag.x),
                   CourseFlag.x = sum(CourseFlag.x),
                   DistFlag.x = sum(DistFlag.x),
                   RateFlag.y = sum(RateFlag.y),
                   CourseFlag.y = sum(CourseFlag.y),
                   DistFlag.y = sum(DistFlag.y)) %>% 
  tidyr::gather("Flag", "Count") %>% 
  dplyr::mutate(Source = ifelse(grepl(".x", Flag), "Candidate", "Correct"),
                Flag = substr(Flag, 1, nchar(Flag)-2)) %>% 
  ggplot(aes(Flag, Count, fill = Source)) +
  geom_bar(stat = "identity", position = "dodge") +
  ggtitle("Observations Kept by Correct")
```
```{r}
join %>% 
  dplyr::filter(Keep.y < Keep.x) %>% 
  dplyr::select(RateFlag.x, CourseFlag.x, DistFlag.x, RateFlag.y, CourseFlag.y, DistFlag.y) %>% 
  dplyr::summarise(RateFlag.x = sum(RateFlag.x),
                   CourseFlag.x = sum(CourseFlag.x),
                   DistFlag.x = sum(DistFlag.x),
                   RateFlag.y = sum(RateFlag.y),
                   CourseFlag.y = sum(CourseFlag.y),
                   DistFlag.y = sum(DistFlag.y)) %>% 
  tidyr::gather("Flag", "Count") %>% 
  dplyr::mutate(Source = ifelse(grepl(".x", Flag), "Candidate", "Correct"),
                Flag = substr(Flag, 1, nchar(Flag)-2)) %>% 
  ggplot(aes(Flag, Count, fill = Source)) +
  geom_bar(stat = "identity", position = "dodge") +
  ggtitle("Observations Kept by Candidate")
```